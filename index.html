<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Rifa Interativa</title>
  <style>
    /* Mantenha seus estilos existentes */
    body {
      background: #fefefe;
      font-family: sans-serif;
    }
    .container {
      position: relative;
      width: 864px;
      margin: auto;
    }
    .rifa-bg {
      width: 100%;
      display: block;
    }
    .numero {
      position: absolute;
      width: 52px;
      height: 52px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 16px;
      color: black;
      background-color: rgba(255, 255, 255, 0.8);
      border: 2px solid #333;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .numero:hover {
      transform: scale(1.1);
    }
    .vendido {
      background-color: red !important;
      color: white !important;
      border-color: darkred !important;
      box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
    }
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 24px;
      z-index: 1000;
    }
    .error-message {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #ff4444;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      display: none;
      z-index: 1000;
    }
  </style>
</head>
<body>

<div class="loading" id="loading">Carregando números da rifa...</div>
<div class="error-message" id="errorMessage"></div>

<div class="container">
  <img src="https://i.ibb.co/9mfXL8vR/Rifa-sem-numeros.jpg" alt="Rifa" class="rifa-bg">
  <!-- Todos os números posicionados aqui -->
  <div class="numero" data-valor="1" style="left: 106.00px; top: 374.00px;">1</div>
  <div class="numero" data-valor="2" style="left: 173.22px; top: 374.00px;">2</div>
  <div class="numero" data-valor="3" style="left: 240.44px; top: 374.00px;">3</div>
  <div class="numero" data-valor="4" style="left: 307.66px; top: 374.00px;">4</div>
  <div class="numero" data-valor="5" style="left: 374.88px; top: 374.00px;">5</div>
  <div class="numero" data-valor="6" style="left: 442.10px; top: 374.00px;">6</div>
  <div class="numero" data-valor="7" style="left: 509.32px; top: 374.00px;">7</div>
  <div class="numero" data-valor="8" style="left: 576.54px; top: 374.00px;">8</div>
  <div class="numero" data-valor="9" style="left: 643.76px; top: 374.00px;">9</div>
  <div class="numero" data-valor="10" style="left: 710.98px; top: 374.00px;">10</div>
  <div class="numero" data-valor="11" style="left: 106.00px; top: 442.78px;">11</div>
  <div class="numero" data-valor="12" style="left: 173.22px; top: 442.78px;">12</div>
  <div class="numero" data-valor="13" style="left: 240.44px; top: 442.78px;">13</div>
  <div class="numero" data-valor="14" style="left: 307.66px; top: 442.78px;">14</div>
  <div class="numero" data-valor="15" style="left: 374.88px; top: 442.78px;">15</div>
  <div class="numero" data-valor="16" style="left: 442.10px; top: 442.78px;">16</div>
  <div class="numero" data-valor="17" style="left: 509.32px; top: 442.78px;">17</div>
  <div class="numero" data-valor="18" style="left: 576.54px; top: 442.78px;">18</div>
  <div class="numero" data-valor="19" style="left: 643.76px; top: 442.78px;">19</div>
  <div class="numero" data-valor="20" style="left: 710.98px; top: 442.78px;">20</div>
  <div class="numero" data-valor="21" style="left: 106.00px; top: 511.56px;">21</div>
  <div class="numero" data-valor="22" style="left: 173.22px; top: 511.56px;">22</div>
  <div class="numero" data-valor="23" style="left: 240.44px; top: 511.56px;">23</div>
  <div class="numero" data-valor="24" style="left: 307.66px; top: 511.56px;">24</div>
  <div class="numero" data-valor="25" style="left: 374.88px; top: 511.56px;">25</div>
  <div class="numero" data-valor="26" style="left: 442.10px; top: 511.56px;">26</div>
  <div class="numero" data-valor="27" style="left: 509.32px; top: 511.56px;">27</div>
  <div class="numero" data-valor="28" style="left: 576.54px; top: 511.56px;">28</div>
  <div class="numero" data-valor="29" style="left: 643.76px; top: 511.56px;">29</div>
  <div class="numero" data-valor="30" style="left: 710.98px; top: 511.56px;">30</div>
  <div class="numero" data-valor="31" style="left: 106.00px; top: 580.34px;">31</div>
  <div class="numero" data-valor="32" style="left: 173.22px; top: 580.34px;">32</div>
  <div class="numero" data-valor="33" style="left: 240.44px; top: 580.34px;">33</div>
  <div class="numero" data-valor="34" style="left: 307.66px; top: 580.34px;">34</div>
  <div class="numero" data-valor="35" style="left: 374.88px; top: 580.34px;">35</div>
  <div class="numero" data-valor="36" style="left: 442.10px; top: 580.34px;">36</div>
  <div class="numero" data-valor="37" style="left: 509.32px; top: 580.34px;">37</div>
  <div class="numero" data-valor="38" style="left: 576.54px; top: 580.34px;">38</div>
  <div class="numero" data-valor="39" style="left: 643.76px; top: 580.34px;">39</div>
  <div class="numero" data-valor="40" style="left: 710.98px; top: 580.34px;">40</div>
  <div class="numero" data-valor="41" style="left: 106.00px; top: 649.12px;">41</div>
  <div class="numero" data-valor="42" style="left: 173.22px; top: 649.12px;">42</div>
  <div class="numero" data-valor="43" style="left: 240.44px; top: 649.12px;">43</div>
  <div class="numero" data-valor="44" style="left: 307.66px; top: 649.12px;">44</div>
  <div class="numero" data-valor="45" style="left: 374.88px; top: 649.12px;">45</div>
  <div class="numero" data-valor="46" style="left: 442.10px; top: 649.12px;">46</div>
  <div class="numero" data-valor="47" style="left: 509.32px; top: 649.12px;">47</div>
  <div class="numero" data-valor="48" style="left: 576.54px; top: 649.12px;">48</div>
  <div class="numero" data-valor="49" style="left: 643.76px; top: 649.12px;">49</div>
  <div class="numero" data-valor="50" style="left: 710.98px; top: 649.12px;">50</div>
  <div class="numero" data-valor="51" style="left: 106.00px; top: 717.90px;">51</div>
  <div class="numero" data-valor="52" style="left: 173.22px; top: 717.90px;">52</div>
  <div class="numero" data-valor="53" style="left: 240.44px; top: 717.90px;">53</div>
  <div class="numero" data-valor="54" style="left: 307.66px; top: 717.90px;">54</div>
  <div class="numero" data-valor="55" style="left: 374.88px; top: 717.90px;">55</div>
  <div class="numero" data-valor="56" style="left: 442.10px; top: 717.90px;">56</div>
  <div class="numero" data-valor="57" style="left: 509.32px; top: 717.90px;">57</div>
  <div class="numero" data-valor="58" style="left: 576.54px; top: 717.90px;">58</div>
  <div class="numero" data-valor="59" style="left: 643.76px; top: 717.90px;">59</div>
  <div class="numero" data-valor="60" style="left: 710.98px; top: 717.90px;">60</div>
  <div class="numero" data-valor="61" style="left: 106.00px; top: 786.68px;">61</div>
  <div class="numero" data-valor="62" style="left: 173.22px; top: 786.68px;">62</div>
  <div class="numero" data-valor="63" style="left: 240.44px; top: 786.68px;">63</div>
  <div class="numero" data-valor="64" style="left: 307.66px; top: 786.68px;">64</div>
  <div class="numero" data-valor="65" style="left: 374.88px; top: 786.68px;">65</div>
  <div class="numero" data-valor="66" style="left: 442.10px; top: 786.68px;">66</div>
  <div class="numero" data-valor="67" style="left: 509.32px; top: 786.68px;">67</div>
  <div class="numero" data-valor="68" style="left: 576.54px; top: 786.68px;">68</div>
  <div class="numero" data-valor="69" style="left: 643.76px; top: 786.68px;">69</div>
  <div class="numero" data-valor="70" style="left: 710.98px; top: 786.68px;">70</div>
  <div class="numero" data-valor="71" style="left: 106.00px; top: 855.46px;">71</div>
  <div class="numero" data-valor="72" style="left: 173.22px; top: 855.46px;">72</div>
  <div class="numero" data-valor="73" style="left: 240.44px; top: 855.46px;">73</div>
  <div class="numero" data-valor="74" style="left: 307.66px; top: 855.46px;">74</div>
  <div class="numero" data-valor="75" style="left: 374.88px; top: 855.46px;">75</div>
  <div class="numero" data-valor="76" style="left: 442.10px; top: 855.46px;">76</div>
  <div class="numero" data-valor="77" style="left: 509.32px; top: 855.46px;">77</div>
  <div class="numero" data-valor="78" style="left: 576.54px; top: 855.46px;">78</div>
  <div class="numero" data-valor="79" style="left: 643.76px; top: 855.46px;">79</div>
  <div class="numero" data-valor="80" style="left: 710.98px; top: 855.46px;">80</div>
  <div class="numero" data-valor="81" style="left: 106.00px; top: 924.24px;">81</div>
  <div class="numero" data-valor="82" style="left: 173.22px; top: 924.24px;">82</div>
  <div class="numero" data-valor="83" style="left: 240.44px; top: 924.24px;">83</div>
  <div class="numero" data-valor="84" style="left: 307.66px; top: 924.24px;">84</div>
  <div class="numero" data-valor="85" style="left: 374.88px; top: 924.24px;">85</div>
  <div class="numero" data-valor="86" style="left: 442.10px; top: 924.24px;">86</div>
  <div class="numero" data-valor="87" style="left: 509.32px; top: 924.24px;">87</div>
  <div class="numero" data-valor="88" style="left: 576.54px; top: 924.24px;">88</div>
  <div class="numero" data-valor="89" style="left: 643.76px; top: 924.24px;">89</div>
  <div class="numero" data-valor="90" style="left: 710.98px; top: 924.24px;">90</div>
  <div class="numero" data-valor="91" style="left: 106.00px; top: 993.02px;">91</div>
  <div class="numero" data-valor="92" style="left: 173.22px; top: 993.02px;">92</div>
  <div class="numero" data-valor="93" style="left: 240.44px; top: 993.02px;">93</div>
  <div class="numero" data-valor="94" style="left: 307.66px; top: 993.02px;">94</div>
  <div class="numero" data-valor="95" style="left: 374.88px; top: 993.02px;">95</div>
  <div class="numero" data-valor="96" style="left: 442.10px; top: 993.02px;">96</div>
  <div class="numero" data-valor="97" style="left: 509.32px; top: 993.02px;">97</div>
  <div class="numero" data-valor="98" style="left: 576.54px; top: 993.02px;">98</div>
  <div class="numero" data-valor="99" style="left: 643.76px; top: 993.02px;">99</div>
  <div class="numero" data-valor="100" style="left: 710.98px; top: 993.02px;">100</div>
</div>

<script>
  // URL do seu Apps Script (mesma que você já tem)
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzzlp-leCRpkQRB364dC2pNdd_qQ-WdeTKcW90PQcO3QWw1A6d00k_U0MZ-cY6XXFFYfw/exec";

  // Função para mostrar/ocultar loading
  function showLoading(show) {
    document.getElementById('loading').style.display = show ? 'flex' : 'none';
  }

  // Função para mostrar erros
  function showError(message) {
    const errorElement = document.getElementById('errorMessage');
    errorElement.textContent = message;
    errorElement.style.display = 'block';
    setTimeout(() => {
      errorElement.style.display = 'none';
    }, 5000);
  }

  // Carrega os números do servidor
  async function loadNumbers() {
    try {
      showLoading(true);
      
      // Adiciona timestamp para evitar cache
      const response = await fetch(`${SCRIPT_URL}?t=${Date.now()}`);
      
      if (!response.ok) {
        throw new Error(`Erro HTTP: ${response.status}`);
      }
      
      const data = await response.json();
      
      // Atualiza a interface
      document.querySelectorAll('.numero').forEach(num => {
        const numero = num.dataset.valor;
        num.classList.toggle('vendido', data[numero] === true);
      });
      
    } catch (error) {
      showError("Erro ao carregar dados. Recarregue a página.");
      console.error("Erro ao carregar:", error);
    } finally {
      showLoading(false);
    }
  }

  // Salva o estado de um número
  async function saveNumber(numero, vendido) {
    try {
      const response = await fetch(SCRIPT_URL, {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ numero, vendido })
      });
      
      if (!response.ok) {
        throw new Error('Falha ao salvar');
      }
      
      return await response.json();
    } catch (error) {
      console.error("Erro ao salvar:", error);
      throw error;
    }
  }

  // Configura os eventos de clique
  function setupClickHandlers() {
    document.querySelectorAll('.numero').forEach(num => {
      num.addEventListener('click', async () => {
        const numero = num.dataset.valor;
        const novoEstado = !num.classList.contains('vendido');
        
        // Atualização otimista da UI
        num.classList.toggle('vendido', novoEstado);
        
        try {
          await saveNumber(numero, novoEstado);
        } catch (error) {
          // Reverte em caso de erro
          num.classList.toggle('vendido');
          showError("Erro ao salvar. Tente novamente.");
        }
      });
    });
  }

  // Inicialização quando a página carrega
  document.addEventListener('DOMContentLoaded', () => {
    loadNumbers();
    setupClickHandlers();
  });
</script>

</body>
</html>