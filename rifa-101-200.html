<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Rifa Interativa</title>
  <style>
    body {
      background: #fefefe;
      font-family: sans-serif;
    }
    .container {
      position: relative;
      width: 864px;
      margin: auto;
    }
    .rifa-bg {
      width: 100%;
      display: block;
    }
    .numero {
      position: absolute;
      width: 52px;
      height: 52px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 24px;
      color: black;
      background-color: rgba(255, 255, 255, 0.8);
      border: 2px solid #333;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: 0.2s ease-in-out;
    }
    .numero:hover {
      transform: scale(1.1);
    }
    .vendido {
      background-color: red !important;
      color: white !important;
      border-color: white !important;
      box-shadow: 0 0 10px red;
    }
    .loading {
      text-align: center;
      padding: 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>

<div class="container">
  <img src="https://i.ibb.co/9mfXL8vR/Rifa-sem-numeros.jpg" alt="Rifa" class="rifa-bg">
  <div class="numero" data-valor="101" style="left: 106.00px; top: 374.00px;">101</div>
  <div class="numero" data-valor="102" style="left: 173.22px; top: 374.00px;">102</div>
  <div class="numero" data-valor="103" style="left: 240.44px; top: 374.00px;">103</div>
  <div class="numero" data-valor="104" style="left: 307.66px; top: 374.00px;">104</div>
  <div class="numero" data-valor="105" style="left: 374.88px; top: 374.00px;">105</div>
  <div class="numero" data-valor="106" style="left: 442.10px; top: 374.00px;">106</div>
  <div class="numero" data-valor="107" style="left: 509.32px; top: 374.00px;">107</div>
  <div class="numero" data-valor="108" style="left: 576.54px; top: 374.00px;">108</div>
  <div class="numero" data-valor="109" style="left: 643.76px; top: 374.00px;">109</div>
  <div class="numero" data-valor="110" style="left: 710.98px; top: 374.00px;">110</div>
  <div class="numero" data-valor="111" style="left: 106.00px; top: 442.78px;">111</div>
  <div class="numero" data-valor="112" style="left: 173.22px; top: 442.78px;">112</div>
  <div class="numero" data-valor="113" style="left: 240.44px; top: 442.78px;">113</div>
  <div class="numero" data-valor="114" style="left: 307.66px; top: 442.78px;">114</div>
  <div class="numero" data-valor="115" style="left: 374.88px; top: 442.78px;">115</div>
  <div class="numero" data-valor="116" style="left: 442.10px; top: 442.78px;">116</div>
  <div class="numero" data-valor="117" style="left: 509.32px; top: 442.78px;">117</div>
  <div class="numero" data-valor="118" style="left: 576.54px; top: 442.78px;">118</div>
  <div class="numero" data-valor="119" style="left: 643.76px; top: 442.78px;">119</div>
  <div class="numero" data-valor="120" style="left: 710.98px; top: 442.78px;">120</div>
  <div class="numero" data-valor="121" style="left: 106.00px; top: 511.56px;">121</div>
  <div class="numero" data-valor="122" style="left: 173.22px; top: 511.56px;">122</div>
  <div class="numero" data-valor="123" style="left: 240.44px; top: 511.56px;">123</div>
  <div class="numero" data-valor="124" style="left: 307.66px; top: 511.56px;">124</div>
  <div class="numero" data-valor="125" style="left: 374.88px; top: 511.56px;">125</div>
  <div class="numero" data-valor="126" style="left: 442.10px; top: 511.56px;">126</div>
  <div class="numero" data-valor="127" style="left: 509.32px; top: 511.56px;">127</div>
  <div class="numero" data-valor="128" style="left: 576.54px; top: 511.56px;">128</div>
  <div class="numero" data-valor="129" style="left: 643.76px; top: 511.56px;">129</div>
  <div class="numero" data-valor="130" style="left: 710.98px; top: 511.56px;">130</div>
  <div class="numero" data-valor="131" style="left: 106.00px; top: 580.34px;">131</div>
  <div class="numero" data-valor="132" style="left: 173.22px; top: 580.34px;">132</div>
  <div class="numero" data-valor="133" style="left: 240.44px; top: 580.34px;">133</div>
  <div class="numero" data-valor="134" style="left: 307.66px; top: 580.34px;">134</div>
  <div class="numero" data-valor="135" style="left: 374.88px; top: 580.34px;">135</div>
  <div class="numero" data-valor="136" style="left: 442.10px; top: 580.34px;">136</div>
  <div class="numero" data-valor="137" style="left: 509.32px; top: 580.34px;">137</div>
  <div class="numero" data-valor="138" style="left: 576.54px; top: 580.34px;">138</div>
  <div class="numero" data-valor="139" style="left: 643.76px; top: 580.34px;">139</div>
  <div class="numero" data-valor="140" style="left: 710.98px; top: 580.34px;">140</div>
  <div class="numero" data-valor="141" style="left: 106.00px; top: 649.12px;">141</div>
  <div class="numero" data-valor="142" style="left: 173.22px; top: 649.12px;">142</div>
  <div class="numero" data-valor="143" style="left: 240.44px; top: 649.12px;">143</div>
  <div class="numero" data-valor="144" style="left: 307.66px; top: 649.12px;">144</div>
  <div class="numero" data-valor="145" style="left: 374.88px; top: 649.12px;">145</div>
  <div class="numero" data-valor="146" style="left: 442.10px; top: 649.12px;">146</div>
  <div class="numero" data-valor="147" style="left: 509.32px; top: 649.12px;">147</div>
  <div class="numero" data-valor="148" style="left: 576.54px; top: 649.12px;">148</div>
  <div class="numero" data-valor="149" style="left: 643.76px; top: 649.12px;">149</div>
  <div class="numero" data-valor="150" style="left: 710.98px; top: 649.12px;">150</div>
  <div class="numero" data-valor="151" style="left: 106.00px; top: 717.90px;">151</div>
  <div class="numero" data-valor="152" style="left: 173.22px; top: 717.90px;">152</div>
  <div class="numero" data-valor="153" style="left: 240.44px; top: 717.90px;">153</div>
  <div class="numero" data-valor="154" style="left: 307.66px; top: 717.90px;">154</div>
  <div class="numero" data-valor="155" style="left: 374.88px; top: 717.90px;">155</div>
  <div class="numero" data-valor="156" style="left: 442.10px; top: 717.90px;">156</div>
  <div class="numero" data-valor="157" style="left: 509.32px; top: 717.90px;">157</div>
  <div class="numero" data-valor="158" style="left: 576.54px; top: 717.90px;">158</div>
  <div class="numero" data-valor="159" style="left: 643.76px; top: 717.90px;">159</div>
  <div class="numero" data-valor="160" style="left: 710.98px; top: 717.90px;">160</div>
  <div class="numero" data-valor="161" style="left: 106.00px; top: 786.68px;">161</div>
  <div class="numero" data-valor="162" style="left: 173.22px; top: 786.68px;">162</div>
  <div class="numero" data-valor="163" style="left: 240.44px; top: 786.68px;">163</div>
  <div class="numero" data-valor="164" style="left: 307.66px; top: 786.68px;">164</div>
  <div class="numero" data-valor="165" style="left: 374.88px; top: 786.68px;">165</div>
  <div class="numero" data-valor="166" style="left: 442.10px; top: 786.68px;">166</div>
  <div class="numero" data-valor="167" style="left: 509.32px; top: 786.68px;">167</div>
  <div class="numero" data-valor="168" style="left: 576.54px; top: 786.68px;">168</div>
  <div class="numero" data-valor="169" style="left: 643.76px; top: 786.68px;">169</div>
  <div class="numero" data-valor="170" style="left: 710.98px; top: 786.68px;">170</div>
  <div class="numero" data-valor="171" style="left: 106.00px; top: 855.46px;">171</div>
  <div class="numero" data-valor="172" style="left: 173.22px; top: 855.46px;">172</div>
  <div class="numero" data-valor="173" style="left: 240.44px; top: 855.46px;">173</div>
  <div class="numero" data-valor="174" style="left: 307.66px; top: 855.46px;">174</div>
  <div class="numero" data-valor="175" style="left: 374.88px; top: 855.46px;">175</div>
  <div class="numero" data-valor="176" style="left: 442.10px; top: 855.46px;">176</div>
  <div class="numero" data-valor="177" style="left: 509.32px; top: 855.46px;">177</div>
  <div class="numero" data-valor="178" style="left: 576.54px; top: 855.46px;">178</div>
  <div class="numero" data-valor="179" style="left: 643.76px; top: 855.46px;">179</div>
  <div class="numero" data-valor="180" style="left: 710.98px; top: 855.46px;">180</div>
  <div class="numero" data-valor="181" style="left: 106.00px; top: 924.24px;">181</div>
  <div class="numero" data-valor="182" style="left: 173.22px; top: 924.24px;">182</div>
  <div class="numero" data-valor="183" style="left: 240.44px; top: 924.24px;">183</div>
  <div class="numero" data-valor="184" style="left: 307.66px; top: 924.24px;">184</div>
  <div class="numero" data-valor="185" style="left: 374.88px; top: 924.24px;">185</div>
  <div class="numero" data-valor="186" style="left: 442.10px; top: 924.24px;">186</div>
  <div class="numero" data-valor="187" style="left: 509.32px; top: 924.24px;">187</div>
  <div class="numero" data-valor="188" style="left: 576.54px; top: 924.24px;">188</div>
  <div class="numero" data-valor="189" style="left: 643.76px; top: 924.24px;">189</div>
  <div class="numero" data-valor="190" style="left: 710.98px; top: 924.24px;">190</div>
  <div class="numero" data-valor="191" style="left: 106.00px; top: 993.02px;">191</div>
  <div class="numero" data-valor="192" style="left: 173.22px; top: 993.02px;">192</div>
  <div class="numero" data-valor="193" style="left: 240.44px; top: 993.02px;">193</div>
  <div class="numero" data-valor="194" style="left: 307.66px; top: 993.02px;">194</div>
  <div class="numero" data-valor="195" style="left: 374.88px; top: 993.02px;">195</div>
  <div class="numero" data-valor="196" style="left: 442.10px; top: 993.02px;">196</div>
  <div class="numero" data-valor="197" style="left: 509.32px; top: 993.02px;">197</div>
  <div class="numero" data-valor="198" style="left: 576.54px; top: 993.02px;">198</div>
  <div class="numero" data-valor="199" style="left: 643.76px; top: 993.02px;">199</div>
  <div class="numero" data-valor="200" style="left: 710.98px; top: 993.02px;">200</div>
  
  <div class="loading" id="loading">Carregando status dos números...</div>
</div>

<script>
  // Substitua esta URL pela URL do seu Google Apps Script
  const API_URL = "https://script.google.com/macros/s/AKfycbzzbQmiLEVxu5QAbppDvzNBkPZMeAzQ44Sduz8jlM3XPviMlhBXAJNVvR5zLV_1kbsV/exec";
  
  const numeros = document.querySelectorAll('.numero');
  const loadingElement = document.getElementById('loading');
  
  // Esconde os números enquanto carrega
  numeros.forEach(num => num.style.visibility = 'hidden');
  
  // Função para atualizar o estado dos números
  function atualizarNumeros(data) {
    // Cria um objeto para mapear os números vendidos
    const vendidosMap = {};
    
    data.forEach(item => {
      if (item.status === "vendido") {
        vendidosMap[item.numero] = true;
      }
    });
    
    // Atualiza a interface
    numeros.forEach(num => {
      const valor = num.dataset.valor;
      if (vendidosMap[valor]) {
        num.classList.add('vendido');
      } else {
        num.classList.remove('vendido');
      }
      num.style.visibility = 'visible';
    });
    
    // Esconde o loading
    loadingElement.style.display = 'none';
  }
  
  // Faz a requisição para a API
  fetch(API_URL)
    .then(response => {
      if (!response.ok) throw new Error("Erro na requisição");
      return response.json();
    })
    .then(data => {
      atualizarNumeros(data);
    })
    .catch(error => {
      console.error("Erro ao carregar dados:", error);
      loadingElement.textContent = "Erro ao carregar os dados. Recarregue a página.";
      
      // Mostra os números mesmo com erro
      numeros.forEach(num => {
        num.style.visibility = 'visible';
      });
    });

  // Opcional: Atualizar automaticamente a cada 30 segundos
  setInterval(() => {
    fetch(API_URL)
      .then(response => {
        if (!response.ok) throw new Error("Erro na requisição");
        return response.json();
      })
      .then(data => {
        atualizarNumeros(data);
      })
      .catch(error => {
        console.error("Erro ao atualizar dados:", error);
      });
  }, 30000); // 30 segundos
</script>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<div style="text-align: center; margin-top: 20px;">
  <button onclick="salvarComoImagem()" style="padding: 10px 20px; font-size: 18px; cursor: pointer;">
    Salvar como Imagem
  </button>
</div>

<script>
  function salvarComoImagem() {
    const container = document.querySelector(".container");
    if (!container) {
      alert("Conteúdo não encontrado!");
      return;
    }

    html2canvas(container, {
      useCORS: true,
      backgroundColor: "#ffffff"
    }).then(canvas => {
      canvas.toBlob(blob => {
        if (!blob) {
          alert("Erro ao gerar imagem.");
          return;
        }

        const fileName = "rifa-marcada.png";

        if (navigator.canShare && navigator.canShare({ files: [new File([blob], fileName, { type: "image/png" })] })) {
          const file = new File([blob], fileName, { type: "image/png" });
          navigator.share({
            files: [file],
            title: 'Minha Rifa',
            text: 'Confira os números vendidos:',
          }).catch(err => console.log("Compartilhamento cancelado ou falhou:", err));
        } else {
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = url;
          link.download = fileName;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        }
      }, "image/png");
    }).catch(err => {
      console.error("Erro ao gerar imagem:", err);
      alert("Erro ao capturar imagem.");
    });
  }
</script>

</body>
</html>